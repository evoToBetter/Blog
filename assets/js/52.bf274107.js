(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{539:function(e,t,s){"use strict";s.r(t);var r=s(4),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[e._v("jenkins使用html publisher生成的html报告无法正常显示的解决方案")])]),e._v(" "),s("h2",{attrs:{id:"问题的原因-csp限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题的原因-csp限制"}},[e._v("#")]),e._v(" 问题的原因 CSP限制")]),e._v(" "),s("p",[e._v("当出现这种情况的时候建议使用chrome浏览器，然后打开控制台来调试。使用"),s("code",[e._v("F12")]),e._v("打开"),s("br"),e._v("\n然后使用"),s("code",[e._v("F5")]),e._v("刷新页面，我遇到的情况在"),s("code",[e._v("console")]),e._v("页可以看到类似的错误提示：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Blocked script execution in '<URL>' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.\n")])])]),s("p",[e._v("或者")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Refused to load the XXXX\n")])])]),s("p",[e._v("那么可以基本上判定是Jenkins配置的CSP阻止了我们某些文件加载导致的。")]),e._v(" "),s("h2",{attrs:{id:"解决问题-修改csp配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决问题-修改csp配置"}},[e._v("#")]),e._v(" 解决问题 修改CSP配置")]),e._v(" "),s("p",[e._v("简单介绍下(CSP, Content-Security-Policy)[https://content-security-policy.com/],详细信息可以参考链接。"),s("br"),e._v("\nCSP是现代浏览器用于增强网页安全提供的一种http相应文件头，你可以通过他来限制加载的JavaScript，CSS和其他文件的来源。"),s("br"),e._v("\n那么也就是说Jenkins默认的策略限制了我们加载其他地方来源的资源，所以导致了我们无法加载html页面。CSP主要用来防止跨站攻击（XSS）或者其他类似（点击劫持）等的攻击。"),s("br"),e._v("\n我们可以通过修改这个策略来实现加载我们的html报告。")]),e._v(" "),s("ol",[s("li",[e._v("临时修改\n在主页通过"),s("code",[e._v("Manage Jenkins->Script Console")]),e._v("进入脚本执行页面，执行"),s("code",[e._v('System.setProperty("hudson.model.DirectoryBrowserSupport.CSP", ""')]),s("br"),e._v("\n然后重新执行job生成html，就可以搞定了。"),s("br"),e._v("\n这个方案的缺陷是，每次jenkins重启都会重新回到默认配置。每次重启后，都需要再次修复。")]),e._v(" "),s("li",[e._v("永久解决方案"),s("br"),e._v("\n一种为在jenkins的JVM参数中加入"),s("code",[e._v('-Dhudson.model.DirectoryBrowserSupport.CSP=""')]),e._v("\n另外一种为利用startup trigger plugin，groovy plugin实现：新建一个job执行命令"),s("code",[e._v('system.setProperty("hudson.model.DirectoryBrowserSupport.CSP", ""')]),e._v(";在builder triggers模块下选择build when job nodes start;在设置页面build模块下，Add build step->Execute system groovy script, 输入命令"),s("code",[e._v('system.setProperty("hudson.model.DirectoryBrowserSupport.CSP", ""')]),e._v("."),s("br"),e._v("\n需要注意的是设置jenkins的CSP为空可能有隐患，建议收窄范围。具体的设置可以参考(CSP官网)[https://content-security-policy.com/]。这里给大家个例子，这是我使用的配置："),s("br"),e._v(" "),s("code",[e._v("System.setProperty(\"hudson.model.DirectoryBrowserSupport.CSP\", \"default-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src 'self' 'unsafe-inline' data:;\")")])])]),e._v(" "),s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/weixin_33755847/article/details/93219448",target:"_blank",rel:"noopener noreferrer"}},[e._v("持续集成 解决 Jenkins 中无法展示 HTML 样式的问题"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("(Jenkins wiki)[https://wiki.jenkins.io/display/JENKINS/Configuring+Content+Security+Policy]")])])])}),[],!1,null,null,null);t.default=n.exports}}]);