(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{504:function(t,r,e){"use strict";e.r(r);var _=e(4),v=Object(_.a)({},(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",[t._v("介绍时间轮算法的基本知识")])]),t._v(" "),e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" introduction")]),t._v(" "),e("h3",{attrs:{id:"cron"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cron"}},[t._v("#")]),t._v(" cron")]),t._v(" "),e("p",[t._v("cron是类unix系统中的一个软件工具，主要是用于执行自动化的任务。"),e("br"),t._v("\ncron这个词来自于希腊语的χρόνος (英文为chronos)，意思可以翻译为时辰。"),e("br"),t._v("\ncorn主要通过一个叫做“crontab”（cron table）的文件来控制。每个任务需要一个类似于这样的设置，你也可以在jenkins的schedule也是使用了类似的设置："),e("br"),t._v(" "),e("code",[t._v("<minute(0-59)> <hour(0-23)> <day of the month(1-31)> <month(1-12)> <day of the week(0-6)> <command to excute>")]),e("br"),t._v("\n可以有类似的设置："),e("code",[t._v("* * * * * * <command to execute>")]),e("br"),t._v("\n可以使用的符号有：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("symbol")]),t._v(" "),e("th",[t._v("usage")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("comma(,)")]),t._v(" "),e("td",[t._v('分隔多个设置，使其作为一个list，比如"Mon,WED,FRI",就是设置一个周之内的多个时间')])]),t._v(" "),e("tr",[e("td",[t._v("Dash(-)")]),t._v(" "),e("td",[t._v("设置范围，如(2000-2010),指从2000到2010之间")])]),t._v(" "),e("tr",[e("td",[t._v("Percent(%)")]),t._v(" "),e("td",[t._v("会被转换为换行符，并把第一个%之后的字符作为命令的标准输入")])]),t._v(" "),e("tr",[e("td",[t._v("非标准字符")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("L")]),t._v(" "),e("td",[t._v("指最后一个，如5L,表示最后一个星期五")])]),t._v(" "),e("tr",[e("td",[t._v("W")]),t._v(" "),e("td",[t._v("指最近的一个weekday，如15W,表示离15号最近的工作日。")])]),t._v(" "),e("tr",[e("td",[t._v("Hash(#)")]),t._v(" "),e("td",[t._v("表示第几个，如5#3，表示第三个周五")])]),t._v(" "),e("tr",[e("td",[t._v("Question mark(?)")]),t._v(" "),e("td",[t._v("表示任意一个时间即可。")])]),t._v(" "),e("tr",[e("td",[t._v("Slash(/)")]),t._v(" "),e("td",[t._v("表示除的意思，即每个可以整除的数都可以，如*/5,表示每5个数执行一次。")])]),t._v(" "),e("tr",[e("td",[t._v("在jenkins里面还可以使用，H")]),t._v(" "),e("td",[t._v("表示小时，H可以表示每小时执行一次，但是具体执行时间不固定。")])])])]),t._v(" "),e("h3",{attrs:{id:"定时"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定时"}},[t._v("#")]),t._v(" 定时")]),t._v(" "),e("p",[t._v("从人类发明时间开始，执行各类任务都离不开对时间的规划。"),e("br"),t._v("\n那么我们通过cron，其实已经大体上知道了，我们这次希望介绍的是一个定时功能的通用算法。"),e("br"),t._v("\n针对他的数据结构，他被称为timing wheel(时间轮)。"),e("br"),t._v("\n他的主要功能就是实现在指定的时间执行相应的任务。"),e("br"),t._v("\n实现定时功能的工具很多，比如操作系统的crontab，spring框架的quartz，java自带的ScheduleTheradPool等等，"),e("br"),t._v("\n使用时间轮算法的工具也不少比如Netty、Kafka等。")]),t._v(" "),e("h2",{attrs:{id:"实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),e("h3",{attrs:{id:"定时任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[t._v("#")]),t._v(" 定时任务")]),t._v(" "),e("ol",[e("li",[t._v("约定一段时间后单次执行,相对时间和绝对时间可以相互转换（如当前9点，三个小时后执行，也就是12点执行任务）。")]),t._v(" "),e("li",[t._v("多次执行任务，执行之后，将任务重新放回，下次到时间继续执行。")])]),t._v(" "),e("p",[t._v("可能碰到的情况：")]),t._v(" "),e("ol",[e("li",[t._v("一个时间点需要执行多个任务。")]),t._v(" "),e("li",[t._v("并发加入多个任务。")]),t._v(" "),e("li",[t._v("时间粒度要求。")])]),t._v(" "),e("h3",{attrs:{id:"功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),e("ol",[e("li",[t._v("接受定时任务请求")]),t._v(" "),e("li",[t._v("解析定时配置，设置定时")]),t._v(" "),e("li",[t._v("定时任务到期后执行任务，清除不需要重复执行的任务")])]),t._v(" "),e("h3",{attrs:{id:"具体实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#具体实现"}},[t._v("#")]),t._v(" 具体实现")]),t._v(" "),e("p",[t._v("存放时间任务的结构最简单的话为一个"),e("br"),t._v("\n分层时间轮："),e("br"),t._v("\n首先存放")]),t._v(" "),e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Cron",target:"_blank",rel:"noopener noreferrer"}},[t._v("wiki for cron"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.veaxen.com/%E7%AE%97%E6%B3%95-%E6%97%B6%E9%97%B4%E8%BD%AE.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("算法-时间轮"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.cnblogs.com/zhongwencool/p/timing_wheel.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("惊艳的时间轮算法"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.cn/post/6844903702357082125",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kafka中的时间轮算法"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://medium.com/@raghavan99o/hashed-timing-wheel-2192b5ec8082",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hashed Timing Wheel"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);r.default=v.exports}}]);