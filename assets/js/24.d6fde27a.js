(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{510:function(a,t,s){"use strict";s.r(t);var e=s(4),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[a._v("分享在elasticsearch使用过程中的一些心得体会")])]),a._v(" "),s("h2",{attrs:{id:"基础概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础概念"}},[a._v("#")]),a._v(" 基础概念")]),a._v(" "),s("p",[a._v("index\nalias\ntemplate")]),a._v(" "),s("h2",{attrs:{id:"elasticsearch使用技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch使用技巧"}},[a._v("#")]),a._v(" elasticsearch使用技巧")]),a._v(" "),s("p",[a._v("———— elasticsearch查询操作记录\n")]),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#基础概念"}},[a._v("基础概念")])]),s("li",[s("a",{attrs:{href:"#elasticsearch使用技巧"}},[a._v("elasticsearch使用技巧")]),s("ul",[s("li",[s("a",{attrs:{href:"#查询node的磁盘使用情况"}},[a._v("查询node的磁盘使用情况")])]),s("li",[s("a",{attrs:{href:"#查询文档数量"}},[a._v("查询文档数量")])]),s("li",[s("a",{attrs:{href:"#es-index相关api"}},[a._v("es index相关API")])]),s("li",[s("a",{attrs:{href:"#创建index"}},[a._v("创建index")])]),s("li",[s("a",{attrs:{href:"#插入数据"}},[a._v("插入数据")])]),s("li",[s("a",{attrs:{href:"#es-查询相关"}},[a._v("es 查询相关")])]),s("li",[s("a",{attrs:{href:"#mapping相关api"}},[a._v("mapping相关API")])]),s("li",[s("a",{attrs:{href:"#alias相关"}},[a._v("alias相关")])])])])])]),s("p"),a._v(" "),s("h3",{attrs:{id:"查询node的磁盘使用情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询node的磁盘使用情况"}},[a._v("#")]),a._v(" 查询node的磁盘使用情况")]),a._v(" "),s("p",[a._v("假设elasticsearch的地址为：localhost:9200.我们可以把localhost:9200/_cat/allocation?v简写为/_cat/allocation?v，省略前面的地址。"),s("br"),a._v("\n那么如果你想要查询elasticsearch的磁盘使用情况，可以使用curl命令GET /_cat/allocation?v，或者使用浏览器访问/_cat/allocation?v。"),s("br"),a._v("\n示例："),s("br"),a._v("\nshards      disk.indices disk.used    disk.avail disk.total   disk.percent host          ip            node"),s("br"),a._v("\n28        1.5gb       146gb       877.9gb        1tb           14       10.0.0.1  10.0.0.1   f"),s("br"),a._v("\n27        1.4gb       153.1gb     870.8gb        1tb           14       10.0.0.2  10.0.0.2   e"),s("br"),a._v("\n27        1.5gb       157.2gb     866.7gb        1tb           15       10.0.0.3 10.0.0.3  y"),s("br"),a._v("\n其中_cat是es的监控接口；v则是verbose的简写，在任意一个_cat接口后加上这个选项则可以显示每列数据对应的意义。")]),a._v(" "),s("h3",{attrs:{id:"查询文档数量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询文档数量"}},[a._v("#")]),a._v(" 查询文档数量")]),a._v(" "),s("ol",[s("li",[a._v("GET /my_index/_count\n返回信息为：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{\n  "count" : 156,\n  "_shards" : {\n    "total" : 5,\n    "successful" : 5,\n    "skipped" : 0,\n    "failed" : 0\n  }\n}\n')])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("使用_cat接口查询：GET /_cat/indices/my_index?v")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("health status index          uuid                   pri rep docs.count docs.deleted store.size pri.store.size\nyellow open   analysisreport kvVszqcORqaA7CTldXDRRw   5   1        343            0    821.5kb        821.5kb\n")])])]),s("p",[a._v("可以看到两个方法查询的文档数量并不一致。这是因为第一种方法查询的是顶级文档的计数，而_cat接口为嵌套字段创建的文档。\n简单的理解的话，可以把前一个看做es所拥有的记录数，后一个为es中lucene的文档数。")]),a._v(" "),s("p",[a._v("参考链接："),s("a",{attrs:{href:"https://codeday.me/bug/20190211/635036.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("elasticsearch – 弹性搜索文档计数"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"es-index相关api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es-index相关api"}},[a._v("#")]),a._v(" es index相关API")]),a._v(" "),s("h3",{attrs:{id:"创建index"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建index"}},[a._v("#")]),a._v(" 创建index")]),a._v(" "),s("p",[s("code",[a._v("PUT /my_index")])]),a._v(" "),s("h3",{attrs:{id:"插入数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插入数据"}},[a._v("#")]),a._v(" 插入数据")]),a._v(" "),s("p",[s("code",[a._v("PUT /my_index {$data}")])]),a._v(" "),s("h4",{attrs:{id:"es-删除index"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es-删除index"}},[a._v("#")]),a._v(" es 删除index")]),a._v(" "),s("p",[s("code",[a._v("curl -XDELETE localhost:9200/${index_name}")])]),a._v(" "),s("h3",{attrs:{id:"es-查询相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es-查询相关"}},[a._v("#")]),a._v(" es 查询相关")]),a._v(" "),s("h4",{attrs:{id:"es限制返回条数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es限制返回条数"}},[a._v("#")]),a._v(" es限制返回条数")]),a._v(" "),s("p",[a._v("POST /my_index/_search/")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{\n\t"query": {\n\t\t"match_all":{}\n\t},\n\t"size":2\n}\n')])])]),s("h3",{attrs:{id:"mapping相关api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mapping相关api"}},[a._v("#")]),a._v(" mapping相关API")]),a._v(" "),s("h4",{attrs:{id:"创建mapping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建mapping"}},[a._v("#")]),a._v(" 创建mapping")]),a._v(" "),s("p",[a._v("创建mapping需要在")]),a._v(" "),s("h4",{attrs:{id:"获取mapping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取mapping"}},[a._v("#")]),a._v(" 获取mapping")]),a._v(" "),s("p",[a._v("GET /my_index/_mapping")]),a._v(" "),s("h3",{attrs:{id:"alias相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alias相关"}},[a._v("#")]),a._v(" alias相关")]),a._v(" "),s("h4",{attrs:{id:"添加index到alias"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加index到alias"}},[a._v("#")]),a._v(" 添加index到alias")]),a._v(" "),s("p",[s("code",[a._v("PUT /myindex01/_alias/alias")])])])}),[],!1,null,null,null);t.default=r.exports}}]);